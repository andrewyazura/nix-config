{ lib, config, pkgs, ... }:
with lib;
let cfg = config.modules.gnome;
in {
  # generated by https://github.com/nix-community/dconf2nix
  # dconf dump / | dconf2nix > home/gnome/dconf.nix
  imports = [ ./dconf.nix ];

  options.modules.gnome = {
    enable = mkEnableOption "Enable GNOME configuration";
    enablePopShell = mkEnableOption "Enable pop-shell extension";
  };

  config = mkMerge [
    (mkIf cfg.enable { programs.gnome-shell.enable = true; })
    (mkIf cfg.enablePopShell {
      programs.gnome-shell.extensions = (with pkgs.gnomeExtensions; [{ package = pop-shell; }]);
      dconf.settings."org/gnome/desktop/wm/keybindings" = { minimize = [ ]; };
    })
  ];
}
